<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerpBooks</title>

    <link rel="stylesheet" href="assets/libs/bootstrap.min.css"/>
    <link rel="stylesheet" href="assets/css/styles.css"/>

    <script src="assets/libs/jquery-2.1.0.min.js"></script>
    <script src="assets/libs/bootstrap.min.js"></script>

    <script>
        var API_URL = 'http://localhost:8080/';

        function set_scroll_wrapper_height() {
            // Window height - navbar height - banner height - filter bar height
            var h = $(window).height() - $('.navbar').height() - $('.banner').height() - $('.filter-container').outerHeight();

            $('.listing-list-container').height(h);
        }

        $(document).ready(function() {
            // TODO: work on the responsive breakdown - refactor into span6's probably :(
            // TODO: re-apply click/change handlers when new filter fields are added

            $('.add-filter-field').on('click', function() {
                $('.listing-filter-wrapper').append(
                    '<select class="form-control listing-filter">' +
                            '<option value="all">All Books</option>' +
                            '<option value="title">Title</option>' +
                            '<option value="isbn">ISBN</option>' +
                            '<option value="class">Class Code</option>' +
                            '<option value="semester">Semester</option>' +
                            '<option value="prof">Professor</option>' +
                    '</select>'
                );
            });

            $('.listing-filter').on('change', function() {
                var val = $(this).find('option').filter(':selected').val();
                var filter_wrapper = $(this).parent();

                switch(val) {
                    case 'all':
                        filter_wrapper.find('input').remove();
                        filter_wrapper.find('.semester-select').remove();
                        filter_wrapper.css('width', '');
                        break;
                    case 'title':
                    case 'isbn':
                    case 'class':
                    case 'prof':
                        if (filter_wrapper.find('input').length != 0) {
                            break;
                        }

                        filter_wrapper.find('.semester-select').remove();
                        filter_wrapper.width(300);
                        filter_wrapper.append('<input type="text" class="form-control filter-input" />');
                        break;
                    case 'semester':
                        if (filter_wrapper.find('select').length > 1) {
                            break;
                        }

                        var semester_url = API_URL + 'books/semesters';

                        $.get(semester_url, function(data) {
                            // TODO: replace hardcoded long names with api call
                            var name_map = {
                                'FL': 'Fall',
                                'SM': 'Summer',
                                'SP': 'Spring',
                                'WN': 'Winter'
                            };

                            filter_wrapper.find('input').remove();
                            filter_wrapper.width(300);
                            filter_wrapper.append('<select class="form-control semester-select"></select>');
                            var options = [];
                            for (var i = 0; i < data.length; i++) {
                                var sem_val = data[i].semester + ' ' + data[i].year;
                                var sem_str = name_map[data[i].semester] + ' ' + data[i].year;

                                //options.push('<option value="' + sem_val + '">' + sem_str + '</option>');
                                var s = filter_wrapper.find('.semester-select');
                                s.append(new Option(sem_str, sem_val));
                            }
                        });
                        break;
                }
            });

            set_scroll_wrapper_height();

            // On window resize, set the list container height
            var timeoutID = null;
            $(window).on('resize', function() {
                if (timeoutID != null) {
                    clearTimeout(timeoutID);
                }

                timeoutID = setTimeout(set_scroll_wrapper_height, 200);
            });

            $('.listing-list .listing').on('click', function() {
                $('.listing-list .listing.selection').removeClass('selection');
                $(this).addClass('selection');
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- Begin base.html -->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button class="navbar-toggle" data-toggle="collapse" data-target="#top-nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                    <a class="navbar-brand" href="">
                        <img src="assets/img/logo.png" class="nav-logo"/>
                    </a>
                </div>
                <div class="collapse navbar-collapse pull-right" id="top-nav-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">Buy</a></li>
                        <li><a href="#">Sell</a></li>
                        <li><a href="#">Log In</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="banner row">
            <img class="col-xs-12" src="assets/img/banner.jpg" />
            <div class="header-holder">
                <h1>TerpBooks</h1>
                <h2>Buy, sell, and trade textbooks for UMD classes.</h2>
            </div>
        </div>
        <!-- End base.html -->

        <div class="row filter-container">
            <div class="col-xs-12">
                <div class="filter-field-wrapper">
                    <p>Search For:</p>

                    <div class="listing-filter-wrapper">
                        <select class="form-control listing-filter">
                            <option value="all">All Books</option>
                            <option value="title">Title</option>
                            <option value="isbn">ISBN</option>
                            <option value="class">Class Code</option>
                            <option value="semester">Semester</option>
                            <option value="prof">Professor</option>
                        </select>
                    </div>

                    <img class="add-filter-field" src="assets/img/plus_icon.png" />

                    <p>Sorted By:</p>
                    <select class="form-control listing-sort">
                        <option>Date Posted</option>
                        <option>Price Low to High</option>
                        <option>Price High to Low</option>
                        <option>Alphabetically</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Start code for listings -->
        <div class="row">
            <div class="col-xs-4 listing-list-container">
                <ul class="listing-list">
                    <li class="listing">
                        <h3>Book Title 1: Book Subtitle 1</h3>
                        <h4 class="listing-price">$100.00</h4>
                        <h4>ABCD123, Fall 2012</h4>
                        <h4 class="listing-date">Posted 3/1/2014</h4>
                    </li>

                    <li class="listing">
                        <h3>Title of Book Number 2</h3>
                        <h4 class="listing-price">$25.00</h4>
                        <h4>No class information, Spring 2013</h4>
                        <h4 class="listing-date">Posted 2/1/2014</h4>
                    </li>

                    <li class="listing">
                        <h3>This is the 3rd Textbook</h3>
                        <h4 class="listing-price">$100.00</h4>
                        <h4>EFGH456, Winter 2011</h4>
                        <h4 class="listing-date">Posted 1/1/2014</h4>
                    </li>

                    <li class="listing">
                        <h3>Untitled Textbook</h3>
                        <h4 class="listing-price">$0.00</h4>
                        <h4>No class information</h4>
                        <h4 class="listing-date">Posted 11/1/2014</h4>
                    </li>
                </ul>
            </div>

            <div class="col-xs-8 listing-info">

            </div>
        </div>
    </div>
</body>
</html>